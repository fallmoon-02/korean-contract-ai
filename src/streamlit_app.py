import streamlit as st
import requests

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1) ì„¤ì •: ì—¬ëŸ¬ë¶„ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ì˜ URLì„ ì…ë ¥í•˜ì„¸ìš”
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BASE_URL = st.secrets.get("BASE_URL", "https://your-service.onrender.com")

st.set_page_config(page_title="AI ê³„ì•½ì„œ ì„œë¹„ìŠ¤", layout="centered")

st.title("ğŸ¤ AI í˜‘ì—…í˜• í•œêµ­ì–´ ê³„ì•½ì„œ ì„œë¹„ìŠ¤")
st.write("ê³„ì•½ì„œ ì´ˆì•ˆ ìƒì„±, ë¦¬ìŠ¤í¬ ë¶„ì„, ìœ ì‚¬ í…œí”Œë¦¿ ì¶”ì²œì„ Streamlitìœ¼ë¡œ ì‰½ê²Œ ì‚¬ìš©í•´ë³´ì„¸ìš”.")

tabs = st.tabs(["ê³„ì•½ì„œ ì´ˆì•ˆ", "ë¦¬ìŠ¤í¬ ë¶„ì„", "ìœ ì‚¬ í…œí”Œë¦¿"])

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2) ê³„ì•½ì„œ ì´ˆì•ˆ ìƒì„± íƒ­
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with tabs[0]:
    st.header("1) ê³„ì•½ì„œ ì´ˆì•ˆ ìƒì„±")
    party_a = st.text_input("ê³„ì•½ ë‹¹ì‚¬ì A", "")
    party_b = st.text_input("ê³„ì•½ ë‹¹ì‚¬ì B", "")
    subject = st.text_input("ê³„ì•½ ëª©ì ", "")
    date    = st.date_input("íš¨ë ¥ ë°œìƒì¼")
    if st.button("ì´ˆì•ˆ ìƒì„±"):
        payload = {
            "party_a": party_a,
            "party_b": party_b,
            "subject": subject,
            "date":    date.isoformat(),
        }
        with st.spinner("ì´ˆì•ˆ ìƒì„± ì¤‘â€¦"):
            res = requests.post(f"{BASE_URL}/generate_draft", json=payload)
        if res.ok:
            st.success("ìƒì„± ì™„ë£Œ!")
            st.text_area("ê³„ì•½ì„œ ì´ˆì•ˆ", res.json().get("draft", ""), height=300)
        else:
            st.error(f"ì˜¤ë¥˜: {res.status_code}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3) ë¦¬ìŠ¤í¬ ë¶„ì„ íƒ­
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with tabs[1]:
    st.header("2) ì¡°í•­ë³„ ë¦¬ìŠ¤í¬ ë¶„ì„")
    clause = st.text_area("ì¡°í•­ í…ìŠ¤íŠ¸", height=100)
    if st.button("ë¶„ì„í•˜ê¸°"):
        with st.spinner("ë¶„ì„ ì¤‘â€¦"):
            res = requests.post(f"{BASE_URL}/analyze_risk", json={"clause": clause})
        if res.ok:
            st.success("ë¶„ì„ ì™„ë£Œ!")
            st.metric("ë¦¬ìŠ¤í¬ ë ˆì´ë¸”", res.json().get("risk_label"))
        else:
            st.error(f"ì˜¤ë¥˜: {res.status_code}")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4) ìœ ì‚¬ í…œí”Œë¦¿ ì¶”ì²œ íƒ­
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with tabs[2]:
    st.header("3) ìœ ì‚¬ í…œí”Œë¦¿ ì¶”ì²œ")
    clause2 = st.text_area("ì¡°í•­ í…ìŠ¤íŠ¸", height=100)
    if st.button("ì¶”ì²œë°›ê¸°"):
        with st.spinner("ê²€ìƒ‰ ì¤‘â€¦"):
            res = requests.post(f"{BASE_URL}/recommend_templates", json={"clause": clause2})
        if res.ok:
            st.success("ì¶”ì²œ ì™„ë£Œ!")
            templates = res.json().get("templates", [])
            for t in templates:
                st.markdown(f"**{t['title']}** (score: {t['score']:.3f})")
                st.write(t["snippet"])
                st.markdown("---")
        else:
            st.error(f"ì˜¤ë¥˜: {res.status_code}")
